<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resuma site</title>
    <link rel="icon" type="image/x-icon" href="eye.svg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Germania+One&family=New+Amsterdam&family=Protest+Guerrilla&display=swap" rel="stylesheet">

    <style>
        * {
            font-family: "New Amsterdam", sans-serif;
        }

        @keyframes fader {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        @keyframes drop {
            0% {
                opacity: 0;
                transform: translateY(-250px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        body {
            margin: 0;
            color: white;
            font-weight: 400;
            font-style: normal;
            letter-spacing: 0.2rem;
        }

        #app {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            min-height: calc(100vh - 10px);
            gap: 2rem;
            background-color: black;
            border-top: 5px solid;
            border-bottom: 5px solid;

            &::before {
                content: '';
                width: 10rem;
                height: 10rem;
                background-color: white;
                position: fixed;
                left: -7rem;
                top: -7rem;
                transform: rotate(45deg);
            }

            &::after {
                content: '';
                width: 10rem;
                height: 10rem;
                background-color: white;
                position: fixed;
                right: -7rem;
                bottom: -7rem;
                transform: rotate(45deg);
            }

            #header-summary {
                display: flex;
                flex-direction: column;
                align-items: center;
                animation: drop 2s ease 0s 1 normal forwards;
                margin-top: 2rem;

                #header-summary-content {
                    display: flex;
                    align-items: center;
                    gap: 1rem;

                    #header-summary-content-infos {
                        display: flex;
                        flex-direction: column;
                        align-items: center;

                        h1 {
                            margin: 0;
                            margin-top: -5px;
                        }

                        p {
                            margin: 0;
                            font-size: 0.75rem;
                        }
                    }

                    #title-content-logo {
                        width: 3rem;
                    }
                }

            }

            #loading {
                display: none;
                object-fit: cover;
                height: 20rem;
                animation: fader 2s ease 0s 1 normal forwards;
            }

            #content {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                background-color: white;
                width: 80%;
                max-width: 40rem;
                padding: 1rem;
                border-radius: 0.5rem;
                transition: 0.5s;
                margin-bottom: 2rem;

                form {
                    display: flex;
                    flex-direction: column;
                    gap: 0.5rem;

                    label {
                        display: flex;
                        flex-direction: column;
                        gap: 0.3rem;
                        color: black;
                        font-weight: 200;
                    }

                    input {
                        height: 2rem;
                        border-radius: 0.5rem;
                        border: 1px solid rgb(65, 65, 65);
                        padding: 0.3rem;
                    }

                    button {
                        height: 2.5rem;
                        margin-top: 1rem;
                        font-size: 16px;
                        border: 1px solid rgb(65, 65, 65);
                        letter-spacing: 0.25rem;
                        border-radius: 0.5rem;
                        background-color: unset;
                        cursor: pointer;
                        

                        &:hover {
                            background-color: rgb(230, 230, 230);
                        }
                    }
                }

                #summary {
                    display: none;
                    white-space: pre-line;
                    flex-direction: column;
                    color: black;
                    overflow-y: auto;
                    max-height: 20rem;
                    border-top: 1px solid rgb(163, 163, 163);
                    padding-right: 1rem;
                    gap: 0.5rem;
                    animation: fader 2s ease 0s 1 normal forwards;

                    #title {
                        display: flex;
                        gap: 0.5rem;
                        width: 100%;
                        align-items: center;
                        justify-content: space-between;
                        animation: none;

                        button {
                            height: 2rem;
                            font-size: 10px;
                            border: 1px solid rgb(65, 65, 65);
                            letter-spacing: 0.25rem;
                            border-radius: 0.5rem;
                            background-color: unset;
                            cursor: pointer;
                            
                            &:hover {
                                background-color: rgb(230, 230, 230);
                            }
                        }
                    }
                }
            }
        }
    </style>
    <script> 
        const LAST_API_KEY = 'LAST-API-KEY';

        const handleLastApiKey = () => {
            const inputApiKey = document.getElementById('inputApiKey');
            const lastApiKey = localStorage.getItem(LAST_API_KEY);

            if(!lastApiKey) return;

            inputApiKey.value = lastApiKey;
        }

        window.addEventListener('load', handleLastApiKey);

        const handleForm = async (event) => {
            event.preventDefault();
            const contentArea = document.getElementById('content');
            const loadingImg = document.getElementById('loading');
            const summaryArea = document.getElementById('summary');
            const data = new FormData(event.target);
            const apiKey = data.get('apiKey');
            const site = data.get('site');

            if(!apiKey || !site) {
                return;
            }
            
            const queryString = new URLSearchParams({
                apiKey: apiKey,
                urlToPrint: site
            }).toString();

            contentArea.style.opacity = 0;

            setTimeout(() => {
                contentArea.style.display = 'none';
                loadingImg.style.display = 'block';
            }, 600);

            try {
                const response = await fetch(`https://resuma-site.netlify.app/api/resume-page?${queryString}`);
                const dataRes = await response.json();
                summaryArea.style.display = 'flex';
                summaryArea.innerHTML = `
                <div id="title">
                    <h2>Resumo:</h2>
                    <button onclick="handleCopyResume()">Copiar resumo</button>
                </div>
                <span>${dataRes.resume ?? 'Erro ao tentar resumir.'}</span>
                `;
                contentArea.style.display = 'flex';
                contentArea.style.opacity = 1;
                loadingImg.style.display = 'none';
    
                localStorage.setItem(LAST_API_KEY, apiKey);
            } catch (error) {
                summaryArea.style.display = 'flex';
                summaryArea.innerHTML = `<br /><span>Erro ao tentar resumir.</span>`;
                contentArea.style.display = 'flex';
                contentArea.style.opacity = 1;
                loadingImg.style.display = 'none';
            }

        }

        const handleCopyResume = () => {
            const summary = document.getElementById('summary');

            navigator.clipboard.writeText(summary.innerText);
            alert('Resumo copiado!');
        }
    </script>
</head>
<body>
    <div id="app">
        <div id="header-summary">
            <div id="header-summary-content">
                <img id="header-summary-content-logo" src="eye.svg" alt="logo" />
                <span id="header-summary-content-infos">
                    <h1>Resuma site</h1>
                    <p>By Franklin V. Barbosa</p>
                </span>
            </div>
        </div>
        <div id="content">
            <form onsubmit="handleForm(event)">
                <label>
                    Sua chave da openAi:
                    <input id="inputApiKey" name="apiKey" placeholder="api-key" />
                </label>
                <label>
                    Link do site:
                    <input name="site" placeholder="https://" />
                </label>
                <button type="submit">Resumir</button>
            </form>

            <div id="summary"></div>
        </div>
        <img id="loading" src="loading.gif" alt="loading" />
    </div>
</body>
</html>